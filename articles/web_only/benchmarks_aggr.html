<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Short benchmark of Fleiss' kappa and Brennan-Prediger • quadagree</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Short benchmark of Fleiss' kappa and Brennan-Prediger">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">quadagree</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../../articles/web_only/benchmarks_aggr.html">Short benchmark of Fleiss' kappa and Brennan-Prediger</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/benchmarks_long.html">Benchmark of Fleiss' kappa, Cohen's kappa, and the Brennan-Prediger coefficient</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/consistency.html">Consistency with missing ratings</a></li>
    <li><a class="dropdown-item" href="../../articles/using_fleissci.html">Using the quadagree package</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../../logo.png" class="logo" alt=""><h1>Short benchmark of Fleiss' kappa and Brennan-Prediger</h1>
            <h3 data-toc-skip class="subtitle">Benchmark for the
aggregated functions</h3>
                        <h4 data-toc-skip class="author">Jonas Moss</h4>
            
            <h4 data-toc-skip class="date">4/25/2023</h4>
      

      <div class="d-none name"><code>benchmarks_aggr.rmd</code></div>
    </div>

    
    
<p>The most feature complete <code>R</code> package for agreement
coefficients is <code>irrCAC</code>. It implements Fleiss’ kappa and the
Brennan-Prediger coefficient for both aggregated and long form data.
Despite the fact that their method of inference, based on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>U</mi><annotation encoding="application/x-tex">U</annotation></semantics></math>-statistics,
does not look the same as ours (based on moments) they are equivalent in
the case of aggregated data. Compare the confidence intervals below to
be convinced of this.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://jonasmoss.github.io/quadagree/">"quadagree"</a></span><span class="op">)</span></span>
<span><span class="fu">irrCAC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/irrCAC/man/bp.coeff.dist.html" class="external-link">bp.coeff.dist</a></span><span class="op">(</span><span class="va">dat.fleiss1971</span>, weights <span class="op">=</span> <span class="st">"quadratic"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         coeff.name     coeff    stderr      conf.int     p.value        pa   pe</span></span>
<span><span class="co">## 1 Brennan-Prediger 0.3338889 0.1036175 (0.122,0.546) 0.003134299 0.8334722 0.75</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/quadagree.html">bpci_aggr</a></span><span class="op">(</span><span class="va">dat.fleiss1971</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Call: bpci_aggr(x = dat.fleiss1971)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 95% confidence interval (n = 30).</span></span>
<span><span class="co">##     0.025     0.975 </span></span>
<span><span class="co">## 0.1219674 0.5458104 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Sample estimates.</span></span>
<span><span class="co">##     kappa        sd </span></span>
<span><span class="co">## 0.3338889 0.5579971</span></span></code></pre>
<p>For aggregated data, <code>quadagree</code> supports user-supplied
<code>values</code> vectors, transforms, and studentized bootstrapping,
which <code>irrCAC</code> does not. But is it faster? It turns out
<code>quadagree</code> is roughly twice as fast for reasonable numbers
of raters. This suggests there is no benefit in using the moment
formulation (as done in <code>quadagree</code>) when calculating these
coefficients, as <code>quadagree</code> is likely to be substantially
more optimized than <code>irrCAC</code>.</p>
<p>We note that no effort has been made to bin the values. One of the
benefits of the moment formulation of Fleiss’ kappa is its ability to
handle continuous values, and binning will not help here. It is,
however, possible to take advantage of binning when dealing with
categorical data, also in the moment formulation. Implementing binning
is likely to further increase the speed differential between
<code>irrCAC</code> and <code>quadagree</code>, especially when there
are few categories compared to the number of rows, but its utility is
questionable.</p>
<div class="section level2">
<h2 id="benchmarks">Benchmarks<a class="anchor" aria-label="anchor" href="#benchmarks"></a>
</h2>
<p>We will run three benchmarks of various sizes using the
<code>microbenchmark</code> package. We start off with
<code>dat.fleiss1971</code>, which contains
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>30</mn></mrow><annotation encoding="application/x-tex">n=30</annotation></semantics></math>
rows.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">dat.fleiss1971</span></span>
<span><span class="va">irr_bp</span> <span class="op">&lt;-</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">irrCAC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/irrCAC/man/bp.coeff.dist.html" class="external-link">bp.coeff.dist</a></span><span class="op">(</span><span class="va">x</span>, weights <span class="op">=</span> <span class="st">"quadratic"</span><span class="op">)</span></span>
<span><span class="va">irr_fleiss</span> <span class="op">&lt;-</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">irrCAC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/irrCAC/man/fleiss.kappa.dist.html" class="external-link">fleiss.kappa.dist</a></span><span class="op">(</span><span class="va">x</span>, weights <span class="op">=</span> <span class="st">"quadratic"</span><span class="op">)</span></span>
<span><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  <span class="fu">irr_bp</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../../reference/quadagree.html">bpci_aggr</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  <span class="fu">irr_fleiss</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../../reference/quadagree.html">fleissci_aggr</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Unit: microseconds</span></span>
<span><span class="co">##              expr     min       lq     mean   median       uq       max neval</span></span>
<span><span class="co">##         irr_bp(x) 512.136 539.3210 590.4476 549.9970 567.5500  3339.994  1000</span></span>
<span><span class="co">##      bpci_aggr(x) 236.372 253.2975 281.0334 262.2095 271.7070  4356.462  1000</span></span>
<span><span class="co">##     irr_fleiss(x) 532.463 556.0775 600.0553 565.1850 580.8595 11972.417  1000</span></span>
<span><span class="co">##  fleissci_aggr(x) 228.326 246.2600 265.4145 256.7995 265.4405  3026.619  1000</span></span></code></pre>
<p>So <code>quadagree</code> is roughly twice as fast. Let’s see what
happens when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>300</mn></mrow><annotation encoding="application/x-tex">n=300</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">dat.fleiss1971</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  <span class="fu">irr_bp</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../../reference/quadagree.html">bpci_aggr</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  <span class="fu">irr_fleiss</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../../reference/quadagree.html">fleissci_aggr</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Unit: microseconds</span></span>
<span><span class="co">##              expr     min       lq     mean  median       uq      max neval</span></span>
<span><span class="co">##         irr_bp(x) 522.114 550.7680 590.0042 561.734 575.7545 3765.599  1000</span></span>
<span><span class="co">##      bpci_aggr(x) 234.628 256.3135 283.5659 267.825 277.2875 3363.398  1000</span></span>
<span><span class="co">##     irr_fleiss(x) 534.688 569.1725 610.6677 580.529 596.8040 3562.339  1000</span></span>
<span><span class="co">##  fleissci_aggr(x) 229.218 251.1335 267.3655 262.285 271.9920 2946.239  1000</span></span></code></pre>
<p>The run time is almost the same for all methods as it was for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>30</mn></mrow><annotation encoding="application/x-tex">n=30</annotation></semantics></math>,
suggesting that there is substantial overhead to both methods. Let’s
check
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>3000</mn></mrow><annotation encoding="application/x-tex">n=3000</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="co"># x has 3000 elements.</span></span>
<span><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  <span class="fu">irr_bp</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../../reference/quadagree.html">bpci_aggr</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  <span class="fu">irr_fleiss</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../../reference/quadagree.html">fleissci_aggr</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Unit: microseconds</span></span>
<span><span class="co">##              expr      min       lq      mean    median        uq       max</span></span>
<span><span class="co">##         irr_bp(x) 1155.928 1191.705 1300.3245 1204.1130 1222.3515  8321.642</span></span>
<span><span class="co">##      bpci_aggr(x)  458.166  485.511  542.7880  501.3005  512.8220  8476.342</span></span>
<span><span class="co">##     irr_fleiss(x) 1214.808 1244.323 1396.5112 1258.7090 1273.3215 55595.862</span></span>
<span><span class="co">##  fleissci_aggr(x)  483.543  510.538  559.5695  525.1600  535.3945  7557.928</span></span>
<span><span class="co">##  neval</span></span>
<span><span class="co">##   1000</span></span>
<span><span class="co">##   1000</span></span>
<span><span class="co">##   1000</span></span>
<span><span class="co">##   1000</span></span></code></pre>
<p>It appears that <code>bpci_aggr</code> is pulling ahead of
<code><a href="https://rdrr.io/pkg/irrCAC/man/bp.coeff.dist.html" class="external-link">irrCAC::bp.coeff.dist</a></code>.</p>
<p>Let’s finish off with a larger number of categories.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="co"># x has 3000 elements and 50 categories.</span></span>
<span><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  <span class="fu">irr_bp</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../../reference/quadagree.html">bpci_aggr</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  <span class="fu">irr_fleiss</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../../reference/quadagree.html">fleissci_aggr</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Unit: milliseconds</span></span>
<span><span class="co">##              expr      min       lq     mean   median       uq       max neval</span></span>
<span><span class="co">##         irr_bp(x) 4.069577 4.225246 5.467688 4.295928 7.115412 69.519161  1000</span></span>
<span><span class="co">##      bpci_aggr(x) 1.143644 1.194665 1.533498 1.260047 1.340272 62.989804  1000</span></span>
<span><span class="co">##     irr_fleiss(x) 4.194409 4.379644 5.589256 4.459890 7.359672 61.883599  1000</span></span>
<span><span class="co">##  fleissci_aggr(x) 1.166597 1.218840 1.446629 1.271258 1.356411  4.858178  1000</span></span></code></pre>
<p>So <code>quadagree</code> is substantially faster on data with very
many categories and items rated.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jonas Moss.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
